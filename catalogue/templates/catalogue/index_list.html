{% extends 'elococo/base.html' %}

{% block base_container %}
    <h2 class="text-center start_2 end_12">Boutique</h2>
    {% if product_list %}
        {% include "catalogue/navigation.html" with categories=filled_category index=index only %}
        {% if filter_list is None %}
            <div id="boutique" class="grid span_12 span_md_12 gap-3">
        {% else %}
            <div id="boutique" class="grid span_9 span_md_12 gap-3">
        {% endif %}
    {% for product in product_list %}
        <article class="span_3 span_md_6 span_xs_12">
            <h3 class="is-hidden">{{ product.name|title }}</h3>
            {% with product_image=product.productimage_set.first %}
                {% if product_image %}
                    <figure class="hover_figure">
                        <a href="{% url 'catalogue_product_detail' product.slug %}">
                            <img class="rounded" src="{{ product_image.image.url }}"
                                 alt="product_{{ forloop.counter }}_{{ product.name }}"/>
                        </a>
                        {% if product.effective_reduction > 0 %}
                            <div class="info_reduction">
                                - {{ product.effective_reduction }}%
                            </div>
                        {% endif %}
                        <div class="info_price">
                            {{ product.price_exact_ttc|floatformat:2 }} € TTC
                        </div>
                        <figcaption>
                            {{ product.name|title }}
                        </figcaption>
                    </figure>
                {% endif %}
            {% endwith %}
        </article>
    {% endfor %}
    </div>
        {% if filter_list is not None %}
            <section class="span_3 span_md_12 row_md_3 border-start border-primary border-3 ps-3">
                <h2>Filtres associés</h2>
                {% for category, info in filter_list %}
                    {% if info.open %}
                        <ul>

                        {% if selected_category.slug == category.slug %}
                            <li class="link-warning">
                                {% else %}
                            <li class="link-dark">
                        {% endif %}

                    {% else %}
                    </li>
                        {% if selected_category.slug == category.slug %}
                            <li class="link-warning">
                                {% else %}
                            <li class="link-dark">
                        {% endif %}
                    {% endif %}

                <a href="{% url 'catalogue_navigation_categories' category.slug %}">{{ category.category }}
                    ({{ category.products_count__sum }})</a>

                {% for close in info.close %}
                    </li></ul>
                {% endfor %}
                {% endfor %}
            </section>
        {% endif %}
    {% else %}
        <p>Il n'y a plus de produits en stocks ! Revennez un autre jour.</p>
    {% endif %}
{% endblock %}
