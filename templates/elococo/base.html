{% load static %}

<!DOCTYPE html>
<html lang="fr">
<head>
    <link rel="icon" href="{% static random_footer_logo %}"/>
    <meta charset="UTF-8">
    <title>{{ website_title }}</title>
    <link rel="stylesheet" href="{% static "sass/bootstrap_custom.css" %}">
    <link rel="stylesheet" href="{% static "css/base.css" %}">
    <link rel="stylesheet" href="{% static "css/catalogue.css" %}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">
</head>
<body class="{% spaceless %}{% block body_class %}{% endblock %}{% endspaceless %}">

{% include "elococo/navbar.html" %}

<main>
    {% block base_container %}
    {% endblock %}
</main>

{% include "elococo/footer.html" %}

<div class="modal fade" id="basket_modal" tabindex="-1" aria-labelledby="basket_modal" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Mon Panier</h3>
            </div>
            <div class="modal-body">
                <div class="spinner-border text-success" role="status">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-success">Valider mon panier</button>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4"
        crossorigin="anonymous"></script>

<script type="application/javascript">
    let basket_modal = document.getElementById('basket_modal');
    let basket_modal_showed = false;
    let url_get_basket = "{{ url_get_basket }}";
    let httpRequest = new XMLHttpRequest();

    function construct_basket_table(object) {
        let table = document.createElement("table");
        table.classList.add("table");

        return table;
    }

    function treatment() {
        if (httpRequest.readyState === XMLHttpRequest.DONE) {
            if (httpRequest.status === 200) {
                alert(httpRequest.response);
            } else {
                alert('Il y a eu un problème avec la requête.');
            }
        }
    }

    function get_basket() {
        if (basket_modal_showed) {
            return false;
        }

        basket_modal_showed = true;

        if (!httpRequest) {
            alert('Abandon :( Impossible de créer une instance de XMLHTTP');
            return false;
        }

        httpRequest.onreadystatechange = treatment;
        httpRequest.open('GET', url_get_basket);
        httpRequest.setRequestHeader('X-Requested-With', 'XMLHttpRequest');
        httpRequest.send();
    }

    basket_modal.addEventListener('show.bs.modal', get_basket);
</script>

</body>
</html>